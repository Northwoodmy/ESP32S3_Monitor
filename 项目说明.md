# ESP32S3监控项目

## 项目简介

这是一个基于ESP32S3开发的WiFi配置管理器项目，使用Arduino IDE开发环境。项目采用FreeRTOS任务调度，实现现代化的Web界面WiFi配置功能，支持NVS存储，具有完整的模块化C++设计架构。

## 功能特性

### 核心功能
- **多WiFi配置管理**: 支持保存最多3个WiFi配置，按优先级自动连接
- **智能WiFi连接**: 按顺序尝试多个配置，连接失败自动切换
- **AP配置模式**: 无WiFi时自动启动热点配置模式
- **现代化Web界面**: 响应式设计的WiFi配置页面，支持配置列表管理
- **OTA固件升级**: 支持通过Web界面在线升级固件，实时进度监控
- **NVS存储**: WiFi配置信息持久化存储，支持多配置管理
- **实时状态监控**: WiFi连接状态和系统信息监控
- **系统信息展示**: 芯片信息、内存使用、运行时间等

### 技术特性
- 基于FreeRTOS多任务架构
- 模块化C++面向对象设计
- RESTful API接口
- JSON数据交换格式
- 现代化UI/UX设计
- 移动端响应式适配

## 技术规格

- **开发板**: ESP32S3
- **开发环境**: Arduino IDE
- **编程语言**: C++
- **操作系统**: FreeRTOS
- **Web服务器**: ESP32 WebServer
- **存储**: NVS (Non-Volatile Storage)
- **界面**: HTML5 + CSS3 + JavaScript
- **数据格式**: JSON
- **调试方式**: printf输出（无串口配置）

## 系统架构

### 文件结构

```
ESP32S3_Monitor/
├── ESP32S3_Monitor.ino        # 主程序文件
├── Monitor.h                  # 监控器类头文件
├── Monitor.cpp                # 监控器类实现文件
├── ConfigStorage.h            # NVS配置存储类头文件
├── ConfigStorage.cpp          # NVS配置存储类实现文件
├── WiFiManager.h              # WiFi管理器类头文件
├── WiFiManager.cpp            # WiFi管理器类实现文件
├── WebServerManager.h         # Web服务器管理器类头文件
├── WebServerManager.cpp       # Web服务器管理器类实现文件
├── WebServerManager_UI.cpp    # Web界面UI实现文件
├── OTAManager.h               # OTA升级管理器类头文件
├── OTAManager.cpp             # OTA升级管理器类实现文件
└── 项目说明.md                # 项目说明文档
```

### 类设计架构

- **Monitor类**: 核心监控器类，负责Hello World输出任务
- **ConfigStorage类**: NVS存储管理类，负责WiFi配置的持久化存储
- **WiFiManager类**: WiFi连接管理类，负责WiFi连接、重连和AP模式切换
- **WebServerManager类**: Web服务器管理类，负责HTTP服务器和API接口
- **OTAManager类**: OTA升级管理类，负责固件升级流程控制和状态管理

### 任务设计

- **HelloWorldTask**: 优先级2，持续输出"hello world"
- **WiFiManagementTask**: 优先级3，WiFi连接状态监控和管理
- **WebServerTask**: 优先级2，处理HTTP请求和客户端连接

### API接口

- `GET /` - 主配置页面
- `GET /scan` - WiFi网络扫描
- `POST /save` - 保存WiFi配置
- `GET /status` - 获取系统状态
- `GET /info` - 获取系统信息
- `GET /restart` - 重启设备
- `GET /reset` - 重置所有配置
- `GET /wifi-configs` - 获取已保存的WiFi配置列表
- `DELETE /wifi-configs` - 删除指定的WiFi配置
- `POST /connect-wifi` - 手动连接指定的WiFi配置
- `POST /ota-upload` - 上传固件文件进行OTA升级
- `GET /ota-status` - 获取OTA升级状态和进度
- `POST /ota-reboot` - OTA升级成功后重启设备

## 使用说明

### 首次配置

1. 将程序上传到ESP32S3开发板
2. 设备启动后会自动进入AP配置模式
3. 使用手机或电脑连接WiFi热点：`ESP32S3-Config`，密码：`12345678`
4. 浏览器打开 `http://192.168.4.1` 进入配置界面
5. 扫描并选择目标WiFi网络，输入密码
6. 点击连接，设备将自动连接到指定WiFi网络
7. 连接成功后，设备会显示获得的IP地址

### 正常使用

- 设备会自动连接到已配置的WiFi网络
- 连接成功后可通过获得的IP地址访问Web界面
- WiFi连接断开时会自动尝试重连
- 重连失败会自动切换到AP配置模式

### Web界面功能

- **状态指示器**: 实时显示WiFi连接状态（已连接/AP模式/未连接）
- **已保存配置**: 显示已保存的WiFi配置列表，包含优先级标识
- **配置管理**: 支持手动连接和删除WiFi配置
- **WiFi扫描**: 扫描附近可用WiFi网络
- **网络列表**: 显示信号强度和安全类型
- **配置表单**: WiFi SSID和密码输入
- **固件升级**: 支持.bin文件上传，实时进度显示，升级状态监控
- **系统信息**: 设备型号、固件版本、运行时间、可用内存
- **设备管理**: 重启设备、刷新信息、恢复默认配置

## 编译和运行

### 环境要求

1. Arduino IDE 1.8.19 或更高版本
2. ESP32 开发板包 v2.0.0 或更高版本
3. 所需库：
   - WiFi (ESP32内置)
   - WebServer (ESP32内置)
   - Preferences (ESP32内置)
   - ArduinoJson (需安装)

### 编译步骤

1. 在Arduino IDE中打开`ESP32S3_Monitor.ino`
2. 选择开发板：ESP32S3 Dev Module
3. 配置参数：
   - CPU Frequency: 240MHz
   - Flash Size: 16MB
   - Partition Scheme: 
     - **推荐方案一**：使用项目自带的`partitions.csv`（需要手动配置）
     - **简单方案二**：选择Arduino IDE内置的OTA支持方案
4. **使用自定义分区表**（推荐）：
   - 将`partitions.csv`文件放在项目根目录
   - 在Arduino IDE中：工具 → Partition Scheme → Custom
   - 或者编辑项目的`boards.txt`添加自定义分区支持
5. **使用内置分区方案**（简单）：
   - Partition Scheme: **Minimal SPIFFS (1.9MB APP with OTA/190KB SPIFFS)**
   - 或选择：**16M Flash (3MB APP/9.9MB FATFS)**
6. 编译并上传到开发板
7. 打开串口监视器查看启动日志

### OTA分区说明

项目提供的`partitions.csv`分区表配置（最大化利用16MB Flash）：
- **app0/app1**: 各6MB，支持超大型固件和丰富功能
- **nvs**: 20KB，存储WiFi配置等
- **otadata**: 8KB，存储OTA状态
- **spiffs**: 4MB，大容量文件系统存储

⚠️ **重要提醒**：
- 必须选择支持OTA的分区方案才能使用固件升级功能
- 单APP分区的方案（如Default 4MB with spiffs）不支持OTA
- 首次刷入OTA固件后，后续可通过Web界面升级

## 版本更新日志

### v3.2.13 (修复WiFi信号强度显示逻辑) - 小版本更新
- 🔧 **信号强度显示修复**
  - 修正信号条显示顺序：从左到右由弱到强（低→高）
  - 信号条高度：8px → 12px → 16px → 20px
  - 符合标准WiFi信号图标的逻辑习惯
- ✅ **显示逻辑优化**
  - 弱信号时只显示左侧低信号条
  - 强信号时显示所有信号条
  - 信号强度表示更加直观准确
- 🔄 **版本号同步**
  - 更新Web界面显示的固件版本号为v3.2.13
  - 保持版本号与项目进度同步

### v3.2.12 (完善WiFi信号图标对齐) - 小版本更新
- 🎯 **信号条对齐修复**
  - 所有信号条现在对齐底边显示
  - 修复信号条视觉对齐问题
  - 设置固定容器高度确保一致性
- ✅ **视觉效果优化**
  - 信号条从底部对齐向上延伸
  - 符合标准WiFi信号图标显示规范
  - 提供更好的视觉层次感

### v3.2.11 (修复WiFi信号图标显示) - 小版本更新
- 🔧 **WiFi信号图标修复**
  - 修正信号条高度排列顺序（从左到右：高→低）
  - 符合常见WiFi信号图标的视觉习惯
  - 提升用户界面的直观性和易用性
- ✅ **显示逻辑优化**
  - 强信号时左侧高信号条亮起
  - 弱信号时只有右侧低信号条亮起
  - 信号强度表示更加直观准确

### v3.2.10 (清理调试信息) - 小版本更新
- 🧹 **代码清理优化**
  - 移除所有调试用的console.log输出
  - 清理后端冗余的printf调试信息
  - 保持代码简洁和性能优化
- ✅ **功能完善**
  - 进度条功能完全正常工作
  - 保留核心的上传进度监控逻辑
  - 用户界面更加流畅和专业

### v3.2.9 (实现真实上传进度显示) - 小版本更新
- 🎯 **彻底解决进度条问题**
  - 发现根本问题：上传速度太快，错过中间进度
  - 使用XMLHttpRequest替代fetch，实现真实上传进度监控
  - 直接监听upload.progress事件，实时更新进度条
- ✅ **双重进度显示**
  - 上传阶段：显示文件传输进度（0-100%）
  - 处理阶段：显示后端OTA写入进度
  - 完整覆盖整个OTA升级流程
- ✅ **用户体验优化**
  - 真实反映文件上传速度和进度
  - 详细的进度日志和状态提示
  - 流畅的进度条动画效果

### v3.2.8 (增强调试和数据类型修复) - 小版本更新
- 🔧 **调试信息增强**
  - 后端添加详细的OTA状态和进度日志输出
  - 前端添加完整状态数据和上传过程日志
  - 确保状态监控在上传过程中正常运行
- ✅ **JSON数据类型修复**
  - 确保progress字段返回正确的数字类型
  - 强制转换totalSize和writtenSize为整数类型
  - 避免前端解析数据类型错误
- ✅ **上传流程优化**
  - 添加上传开始和完成的详细日志
  - 确保fetch请求不阻塞状态监控
  - 提高调试信息的可读性

### v3.2.7 (修复后端进度计算问题) - 小版本更新
- 🎯 **根本性修复进度条问题**
  - 发现真正问题：后端动态模式下getProgress()返回-1
  - 修复OTAManager进度计算逻辑，基于已写入数据智能估算
  - 简化前端逻辑，直接使用后端返回的真实进度
- ✅ **智能进度算法**
  - 0-500KB: 按比例计算0-50%进度
  - 500KB-1MB: 按比例计算50-90%进度  
  - 1MB以上: 按比例计算90-100%进度
- ✅ **代码优化**
  - 移除前端复杂的模拟进度逻辑
  - 统一进度条更新机制
  - 减少调试日志输出频率

### v3.2.5 (深度修复进度条显示问题) - 小版本更新
- 🐛 **深度修复Web界面进度条显示问题**
  - 添加详细的DOM元素存在性检查
  - 强制设置进度条的CSS样式属性
  - 增强UI更新的健壮性和可靠性
- ✅ **全面调试支持**
  - 添加DOM元素获取状态的详细日志
  - 记录实际的CSS样式更新过程
  - 提供完整的UI更新调试信息
- ✅ **强化样式控制**
  - 强制设置进度条的width、height、background等属性
  - 确保CSS transition效果正常工作
  - 防止样式被其他CSS规则覆盖

### v3.2.4 (修复Web界面进度条动态更新) - 小版本更新
- 🐛 **修复Web界面进度条不变化的问题**
  - 解决动态模式下进度条固定为50%不变的问题
  - 基于用户选择的文件大小计算真实上传进度
  - 进度条能够实时反映实际的上传进度
- ✅ **智能进度计算**
  - 优先使用选择文件的大小计算精确进度
  - 回退机制：无文件信息时使用估算模式
  - 进度范围控制：1%-99%，避免显示异常值
- ✅ **改进用户体验**
  - 显示真实的文件传输进度和大小信息
  - 添加浏览器控制台调试日志
  - 提供更准确的进度反馈和状态显示

### v3.2.3 (优化动态OTA进度显示) - 小版本更新
- ✅ **优化动态大小模式的进度显示**
  - 修复动态模式下进度显示为"0.0%"的问题
  - 在上传过程中显示"已写入 xxx 字节 (动态大小模式)"
  - Web界面支持动态进度显示，显示"上传中..."状态
- ✅ **增强用户体验**
  - 动态模式下进度条显示50%避免用户困惑
  - 提供更清晰的状态反馈和进度信息
  - 改进JSON状态返回，包含progressText字段
- ✅ **完善调试信息**
  - 区分动态模式和正常模式的日志输出
  - 提供更准确的上传状态跟踪
  - 优化错误信息的可读性

### v3.2.2 (实现动态大小OTA上传支持) - 小版本更新
- 🐛 **修复ESP32 WebServer文件大小检测问题**
  - 解决upload.totalSize在UPLOAD_FILE_START阶段为0的问题
  - 实现动态大小OTA上传，不依赖预知文件大小
  - 新增setActualSize()函数在上传完成后设置实际大小
- ✅ **增强OTA上传兼容性**
  - 支持UPDATE_SIZE_UNKNOWN模式的动态上传
  - 改进文件大小验证逻辑，适应不同上传场景
  - 优化空间检查时机，避免过早失败
- ✅ **完善错误处理机制**
  - 新增数据大小不匹配的详细错误报告
  - 改进状态检查逻辑，支持动态和静态两种模式
  - 提供更准确的调试信息和错误定位

### v3.2.1 (修复OTA升级状态管理问题) - 小版本更新
- 🐛 **修复OTA固件上传状态管理问题**
  - 修复"OTA未处于写入状态"错误，优化状态检查逻辑
  - 改进WebServer文件上传响应处理机制
  - 分离上传回调和POST响应处理，避免状态冲突
- ✅ **增强OTA调试功能**
  - 新增详细的状态变化日志记录
  - 添加数据大小和写入进度验证
  - 增强错误报告的准确性和详细程度
- ✅ **提高OTA升级稳定性**
  - 优化状态机逻辑，减少状态切换异常
  - 改进错误处理和恢复机制
  - 提升固件升级成功率和用户体验

### v3.2.0 (最大化Flash空间利用) - 大版本更新
- ✅ **重新设计分区表以最大化利用16MB Flash**
  - APP分区从3.2MB扩大到6MB（增加87.5%）
  - SPIFFS从1.6MB扩大到4MB（增加150%）
  - Flash利用率从约50%提升到99%
  - 移除非必要分区，专注核心功能
- ✅ **超大固件支持**
  - 支持高达6MB的复杂固件
  - 可集成AI、音视频处理等大型功能模块
  - 为未来功能扩展预留充足空间
- ✅ **大容量文件系统**
  - 4MB SPIFFS可存储大量网页资源、配置文件、日志
  - 支持丰富的用户界面和数据存储需求
- ✅ **分区信息实时显示**
  - 启动时显示详细的分区配置信息
  - 验证OTA分区配置的正确性
  - 实时监控可用固件空间
- ✅ **企业级存储规划**
  - 为复杂项目和长期发展设计
  - 消除固件大小限制的开发顾虑
  - 提供工业级应用的存储基础

### v3.1.0 (新增OTA固件升级功能) - 大版本更新
- ✅ **新增OTA固件升级模块**
  - 全新的`OTAManager`类，采用C++模块化设计
  - 支持.bin格式固件文件的在线升级
  - 完整的升级状态管理（空闲、上传、写入、成功、失败）
  - 实时升级进度监控和显示
  - 自动空间检查和错误处理机制
- ✅ **Web界面OTA升级功能**
  - 新增"固件升级"标签页，现代化UI设计
  - 支持文件选择、上传和进度实时显示
  - 升级过程中的详细状态反馈
  - 升级成功后的一键重启功能
  - 升级失败时的重试机制
- ✅ **增强的Web服务器API**
  - `/ota-upload` - 处理固件文件上传
  - `/ota-status` - 获取实时升级状态
  - `/ota-reboot` - 升级成功后重启设备
  - 支持大文件分块上传和状态监控
- ✅ **完善的安全机制**
  - 文件格式验证（仅支持.bin文件）
  - 存储空间预检查（预留10%缓冲空间）
  - 升级过程中的错误恢复机制
  - 上传中断和异常处理
- ✅ **用户体验优化**
  - 升级过程中的友好提示和警告
  - 实时进度条和百分比显示
  - 直观的成功/失败结果反馈
  - 防止升级过程中的误操作

### v3.0.20 (优化WiFi扫描加载状态显示) - 小版本更新
- ✅ **简化WiFi扫描加载状态显示**
  - 移除networkList区域中的scanLoading加载圈圈
  - 只保留扫描按钮上的加载状态指示器
  - 解决扫描时出现两个重复加载圈圈的问题
- ✅ **优化用户界面体验**
  - 扫描时只显示按钮上的"扫描中..."状态
  - 移除不必要的重复视觉元素
  - 提供更简洁清爽的扫描体验
- ✅ **简化JavaScript代码**
  - 移除所有对scanLoading元素的引用和操作
  - 简化scanWiFi和displayNetworks函数逻辑
  - 减少DOM操作的复杂性

### v3.0.19 (修复WiFi扫描重复调用错误) - 小版本更新
- 🐛 **修复WiFi扫描重复调用时的JavaScript错误**
  - 修复scanLoading元素在第二次扫描时为null导致的TypeError
  - 问题原因：displayNetworks函数替换networkList内容时删除了scanLoading元素
  - 解决方案：在scanWiFi和displayNetworks函数中添加null检查
- ✅ **优化扫描加载状态管理**
  - 在scanWiFi函数中添加scanLoading元素的存在性检查
  - 在displayNetworks函数中重新创建scanLoading元素
  - 确保每次扫描时都有正确的加载状态指示器
- ✅ **增强代码健壮性**
  - 防止因DOM元素不存在导致的JavaScript运行时错误
  - 提供更稳定的WiFi扫描用户体验
  - 解决重复扫描时的功能异常问题

### v3.0.18 (移除密码显示切换功能) - 小版本更新
- ✅ **移除密码显示/隐藏切换功能**
  - 删除HTML中的password-toggle元素和👁图标
  - 删除JavaScript中的togglePassword函数
  - 移除🙈图标的动态切换功能
- ✅ **简化密码输入体验**
  - 密码输入框保持传统的password类型
  - 移除可能导致图标重叠的界面元素
  - 提供更简洁清爽的输入界面

### v3.0.17 (修复重复扫描提示) - 小版本更新
- 🐛 **修复重复的"扫描中..."提示问题**
  - 移除HTML中scanLoading元素内的静态"扫描中..."文本
  - 保留按钮上的动态"扫描中..."提示
  - 解决WiFi扫描时显示两个重复提示的问题
- ✅ **优化用户界面体验**
  - 扫描时只显示一个"扫描中..."提示
  - 保持加载动画的视觉效果
  - 提供更清晰简洁的用户反馈

### v3.0.16 (清理调试信息) - 小版本更新
- ✅ **清理详细调试信息**
  - 移除loadSavedWiFiConfigs函数中的详细步骤日志
  - 移除displaySavedWiFiConfigs函数中的数据统计日志
  - 移除deleteWiFiConfig函数中的操作过程日志
- ✅ **保留基本调试输出**
  - 保留关键错误信息的console.error输出
  - 保留DOM元素检查的错误提示
  - 保留必要的异常处理调试信息
- ✅ **优化代码简洁性**
  - 减少不必要的调试信息输出
  - 保持功能完整性的同时提升代码可读性
  - 降低浏览器控制台的信息噪音

### v3.0.15 (修复WiFi连接网络切换导致的界面刷新问题) - 小版本更新
- 🐛 **修复WiFi连接成功后的网络切换问题**
  - 修复ESP32连接新WiFi后IP地址变化导致的HTTP连接重置错误
  - 优化错误处理逻辑，识别"Failed to fetch"错误为可能的连接成功
  - 解决WiFi实际连接成功但前端显示连接失败的问题
- ✅ **智能错误处理机制**
  - 当出现连接重置错误时，自动判断为WiFi连接可能成功
  - 延时3秒后自动刷新界面状态和配置列表
  - 提供友好的用户提示："WiFi连接可能成功，正在检查状态..."
- ✅ **改进用户体验**
  - 解决WiFi保存后配置列表需要手动刷新的问题
  - 自动处理网络环境变化导致的连接中断
  - 确保WiFi连接成功后界面能正确更新显示

### v3.0.14 (修复WiFi连接成功后界面刷新问题) - 小版本更新
- 🐛 **修复WiFi连接成功后界面不自动刷新问题**
  - 为updateStatus和loadSystemInfo函数添加缓存控制机制
  - 使用时间戳参数和HTTP无缓存头部防止浏览器缓存
  - 修复连接成功后需要手动刷新才能看到状态更新的问题
- ✅ **优化WiFi连接后的界面刷新策略**
  - 连接成功后1秒和3秒分别进行两次状态刷新
  - 使用async/await确保状态更新操作完成
  - 同时刷新WiFi状态、配置列表和系统信息
- ✅ **增强数据获取的实时性**
  - 所有状态获取API请求都添加缓存控制
  - 确保获取到服务器端的最新状态数据
  - 解决WiFi状态变化后界面显示延迟的问题
- ✅ **改进刷新信息功能**
  - refreshInfo函数改为异步执行
  - 同时刷新系统信息、WiFi状态和配置列表
  - 提供更完整的信息更新体验

### v3.0.13 (修复DOM元素空值错误) - 小版本更新
- 🐛 **修复DOM元素访问空值错误**
  - 在loadSavedWiFiConfigs函数中添加DOM元素空值检查
  - 防止savedWiFiLoading和savedWiFiList元素为null时的错误
  - 解决"Cannot read properties of null (reading 'classList')"错误
- ✅ **增强代码健壮性**
  - 添加详细的错误日志和警告信息
  - 优雅处理DOM元素不存在的情况
  - 确保删除操作能正常完成而不中断
- ✅ **改进错误处理机制**
  - 区分不同类型的DOM访问错误
  - 提供清晰的错误信息便于调试
  - 保证核心功能在异常情况下的稳定性

### v3.0.12 (增强前端调试和双重刷新机制) - 小版本更新
- 🐛 **强化前端界面刷新机制**
  - 删除成功后立即刷新配置列表
  - 增加延时双重刷新确保数据更新
  - 使用async/await确保刷新操作完成
- ✅ **全面增强前端调试信息**
  - 删除操作每个步骤的详细日志输出
  - 配置列表显示过程的完整跟踪
  - HTTP请求和响应的状态监控
- ✅ **优化用户体验**
  - 提供更详细的操作状态反馈
  - 确保界面状态与服务器数据同步
  - 便于问题排查和状态确认

### v3.0.11 (强化缓存控制和调试信息) - 小版本更新
- 🐛 **解决浏览器缓存导致的刷新问题**
  - 前端请求添加时间戳参数防止浏览器缓存
  - 设置强制无缓存的HTTP头部信息
  - 服务器端添加缓存控制响应头
- ✅ **增强调试信息输出**
  - 前端添加详细的配置加载和删除过程日志
  - 服务器端增强WiFi配置处理的调试输出
  - 便于问题排查和状态监控
- ✅ **优化HTTP请求处理**
  - 明确指定GET方法和无缓存头部
  - 服务器端详细记录配置处理过程
  - 提高数据获取的实时性和准确性

### v3.0.10 (优化WiFi配置删除后的界面刷新) - 小版本更新
- 🐛 **修复删除后界面刷新时序问题**
  - 删除成功后延时500ms再刷新配置列表
  - 确保NVS数据完全刷新后再更新界面显示
  - 解决删除成功但界面仍显示已删除配置的问题
- ✅ **增强删除操作可靠性**
  - 服务器端删除操作完成后等待100ms NVS数据刷新
  - 前端延时刷新避免读取到过期的缓存数据
  - 提高删除操作的用户体验和数据一致性
- ✅ **优化用户界面响应**
  - 删除操作完成后自动刷新配置列表
  - 无需用户手动刷新页面即可看到最新状态
  - 提供更流畅的配置管理体验

### v3.0.9 (修复WiFi配置删除路由问题) - 小版本更新
- 🐛 **修复删除请求路由冲突问题**
  - 将删除WiFi配置的路由从DELETE /wifi-configs改为POST /delete-wifi-config
  - 解决ESP32 WebServer库对同一路径不同HTTP方法的处理冲突
  - 确保删除请求能正确路由到删除处理函数
- ✅ **优化HTTP请求处理**
  - 明确指定GET方法用于获取WiFi配置列表
  - 使用POST方法和FormData传递删除参数
  - 避免路径和HTTP方法的冲突问题
- ✅ **增强系统兼容性**
  - 解决ESP32 WebServer库的已知限制
  - 提高删除功能的可靠性和稳定性

### v3.0.8 (修复WiFi配置删除功能) - 小版本更新
- 🐛 **修复WiFi配置删除功能核心问题**
  - 修正saveWiFiConfigs方法，删除前先清除所有现有配置
  - 解决删除配置后索引不匹配导致的显示问题
  - 确保删除操作后配置列表正确更新
- ✅ **增强删除操作调试信息**
  - 添加详细的删除过程调试输出
  - 打印所有配置状态，便于问题诊断
  - 增强删除操作的错误处理和状态反馈
- ✅ **优化配置存储逻辑**
  - 删除配置时先清除NVS中的旧数据
  - 重新排列有效配置，保持索引连续性
  - 提高配置管理的数据一致性

### v3.0.7 (修复WiFi状态信息显示顺序) - 小版本更新
- 🐛 **修复状态信息显示顺序问题**
  - 修正HTML结构中currentWiFi和statusDetail的位置关系
  - 确保"当前网络"信息显示在"IP地址和信号强度"信息之前
  - 解决v3.0.5版本中状态信息顺序调整未生效的问题
- ✅ **优化用户体验**
  - 状态信息按重要性优先级正确排序
  - 用户首先看到当前连接的WiFi网络名称
  - 然后查看具体的IP地址和信号强度信息

### v3.0.6 (去掉扫描WiFi网络按钮图标) - 小版本更新
- ✅ **简化扫描按钮设计**
  - 去掉扫描WiFi网络按钮的📡图标
  - 采用纯文字"扫描WiFi网络"设计
  - 保持与其他按钮一致的简约风格
- ✅ **界面一致性优化**
  - 统一按钮设计语言，全部采用纯文字方式
  - 界面更加简约清爽，减少视觉干扰
  - 提升整体界面的设计一致性

### v3.0.5 (优化状态信息显示顺序) - 小版本更新
- ✅ **调整WiFi状态信息显示顺序**
  - 将"当前网络"信息调整到第一行显示
  - "IP地址和信号强度"信息调整到第二行显示
  - 提供更清晰的信息层次结构
- ✅ **优化用户体验**
  - 用户首先看到连接的WiFi网络名称
  - 然后查看具体的连接参数信息
  - 信息优先级更符合用户使用习惯

### v3.0.4 (更新页面标题) - 小版本更新
- ✅ **更新Web界面标题**
  - 将页面主标题从"ESP32S3 Monitor"更改为"小屏幕配置"
  - 更贴合实际使用场景和功能定位
  - 提供更直观的用户界面体验

### v3.0.3 (简化页面标题) - 小版本更新
- ✅ **简化Web界面标题**
  - 移除页面头部的"WiFi配置管理器"副标题
  - 保持简洁的"ESP32S3 Monitor"主标题
  - 减少页面视觉干扰，提升界面简洁度

### v3.0.2 (显示当前连接WiFi名称) - 小版本更新
- ✅ **新增当前WiFi名称显示**
  - 在状态指示器中显示当前连接的WiFi网络名称
  - 状态卡片新增绿色"当前网络"信息行
  - 仅在WiFi连接状态下显示，未连接时自动隐藏
- ✅ **系统信息页面增强**
  - 在设备信息中新增"当前WiFi"字段
  - 显示WiFi名称和连接状态
  - 未连接时显示"未连接"状态
- ✅ **API数据扩展**
  - `/status` 和 `/info` 接口新增 `wifi.ssid` 字段
  - 提供当前连接WiFi的SSID信息
  - 保持向后兼容性，新增字段不影响现有功能
- ✅ **用户体验优化**
  - 一目了然的WiFi连接状态和网络名称
  - 绿色字体突出显示当前网络信息
  - 实时更新，连接切换时自动刷新显示

### v3.0.1 (WiFi配置手动连接功能) - 小版本更新
- ✅ **新增手动WiFi切换功能**
  - 在已保存WiFi配置列表中添加"连接"按钮
  - 支持手动选择并连接任意已保存的WiFi配置
  - 连接过程中显示加载状态，防止重复操作
- ✅ **优化用户交互体验**
  - 连接按钮采用绿色主题，与删除按钮形成视觉区分
  - 连接中状态显示"连接中..."文字提示
  - 连接成功后显示IP地址和成功提示
  - 连接失败时显示详细错误信息
- ✅ **完善API接口**
  - 新增 `POST /connect-wifi` 接口处理手动连接请求
  - 支持通过配置索引指定要连接的WiFi
  - 增强错误处理和状态反馈机制
- ✅ **技术实现优化**
  - 复用WiFiManager的tryConnectToConfig方法
  - 20秒连接超时设置，提供充足的连接时间
  - 连接成功后自动刷新状态和配置列表

### v3.0.0 (多WiFi配置管理系统) - 重大功能更新
- 🚀 **全新多WiFi配置管理系统**
  - 支持保存最多3个WiFi配置，按优先级顺序自动连接
  - 新的WiFi配置会自动添加到列表中，已存在的配置会更新密码
  - 配置已满时会替换优先级最低的配置
- ✅ **智能WiFi连接策略**
  - 启动时按保存顺序依次尝试连接WiFi配置
  - 连接失败自动尝试下一个配置，全部失败后启动AP模式
  - 断线重连时也使用多WiFi配置，提高连接成功率
- ✅ **全新Web界面设计**
  - 已保存WiFi配置列表显示，包含优先级标识
  - 支持删除不需要的WiFi配置
  - 分离"已保存配置"和"添加新配置"两个功能区域
  - 实时显示可保存配置数量提示
- ✅ **增强的存储架构**
  - 新的多WiFi配置存储命名空间，与旧配置兼容
  - 支持配置的增删改查操作
  - 保持向后兼容性，自动迁移旧配置
- ✅ **完善的API接口**
  - 新增 `/wifi-configs` 获取已保存配置列表
  - 新增 `DELETE /wifi-configs` 删除指定配置
  - 增强错误处理和状态反馈
- 🎯 **技术架构升级**
  - WiFiConfig结构体封装配置数据
  - WiFiManager支持多配置连接逻辑
  - ConfigStorage扩展为多配置存储系统
  - 完整的配置生命周期管理

### v2.0.8 (简化界面图标设计) - 小版本更新
- ✅ **简化界面设计**
  - 移除标签页导航中的WiFi和系统信息图标
  - 去掉设备管理按钮中的所有图标（刷新、重置、重启）
  - 采用纯文字设计，界面更加简约清爽
- ✅ **优化视觉效果**
  - 调整按钮和标签页的内边距和布局
  - 移除不必要的CSS样式规则
  - 保持功能完整性的同时提升视觉简洁度
- ✅ **提升用户体验**
  - 减少视觉干扰，专注于功能本身
  - 文字更加清晰易读
  - 保持现代化设计风格的同时更加简约

### v2.0.7 (Web界面标签页布局优化) - 小版本更新
- ✅ **重新设计Web界面布局**
  - 将WiFi配置和系统信息分成两个独立的标签页
  - 采用现代化标签页导航设计，支持平滑切换动画
  - 优化移动端用户体验，标签页响应式适配
- ✅ **优化系统信息展示**
  - 将设备信息和设备管理功能分别放在独立卡片中
  - 重新设计按钮布局，采用网格布局和图标设计
  - 增强按钮视觉效果，添加悬停动画和渐变背景
- ✅ **改进界面交互体验**
  - 标签页切换时自动刷新系统信息
  - 优化按钮间距和视觉层次
  - 添加淡入动画效果，提升页面切换体验
- ✅ **代码结构优化**
  - 完善JavaScript事件处理逻辑
  - 修复WiFi扫描按钮状态管理问题
  - 增强CSS样式模块化和可维护性

### v2.0.6 (修复NVS写入逻辑和时序问题) - 小版本更新
- 🐛 **修复NVS配置保存的关键逻辑错误**
  - 修正了Preferences库put方法返回值的错误判断逻辑
  - putString()和putBool()返回写入字节数，0表示失败，非0表示成功
  - 之前错误地将返回值直接作为布尔值使用，导致保存状态判断错误
- 🐛 **解决NVS数据刷新时序问题**  
  - 在Web接口中保存配置后立即检查可能导致NVS数据未刷新
  - 添加100ms延时等待NVS数据刷新到Flash存储
  - 确保配置保存后的状态检查准确性
- ✅ **增强配置保存的调试信息**
  - 详细显示每个配置项的保存结果和写入字节数
  - 分别检查SSID、密码、配置标志的保存状态
  - 提供更精确的错误定位和诊断信息

### v2.0.5 (修复NVS初始化问题) - 小版本更新
- 🐛 **修复NVS存储初始化问题**
  - 添加完整的nvs_flash_init()初始化流程
  - 处理NVS分区截断和格式不兼容的自动修复
  - 增加NVS功能测试，确保读写操作正常
- ✅ **增强配置保存的详细调试**
  - 详细显示每个配置项的保存过程和结果
  - 添加NVS命名空间操作的状态检查
  - 提供更精确的错误诊断信息

### v2.0.4 (修复WiFi配置保存状态显示) - 小版本更新
- 🐛 **修复WiFi配置保存状态显示问题**
  - 修复WiFi连接成功但调试信息显示保存失败的问题
  - 增加配置保存结果的检查和警告提示
  - 改进Web界面的状态反馈，准确显示配置保存状态
- ✅ **增强调试信息**
  - 添加配置存储初始化状态检查
  - 优化WiFi连接和配置保存的调试输出
  - 提供更详细的错误信息和警告提示

### v2.0.3 (新增配置重置功能) - 小版本更新
- ✅ **新增配置重置功能**
  - 在Web界面添加"恢复默认配置"按钮
  - 支持一键清除所有WiFi和系统配置
  - 重置后自动重启设备，回到初始状态
  - 添加详细的确认对话框，防止误操作
- ✅ **增强Web界面设计**
  - 新增warning-btn样式，区分不同危险级别的操作
  - 优化按钮布局和间距
  - 改进用户交互体验
- ✅ **完善API接口**
  - 新增 `/reset` 接口用于配置重置
  - 返回JSON格式的操作结果
  - 支持错误处理和状态反馈

### v2.0.2 (Hello World任务优化) - 小版本更新
- ✅ **优化Hello World任务执行模式**
  - 修改为单次输出模式，输出一次"hello world"后自动结束
  - 优化任务生命周期管理，任务完成后自动清理状态
  - 移除无限循环和延时机制，提高系统资源利用率

### v2.0.1 (Web界面系统信息增强) - 小版本更新
- ✅ **增强Web界面系统信息显示**
  - 新增CPU频率显示（MHz）
  - 新增Flash存储大小显示
  - 新增总内存大小显示
  - 优化系统信息布局和显示顺序
- ✅ **改进延时函数使用**
  - 统一使用vTaskDelay替代delay函数
  - 符合FreeRTOS最佳实践
  - 避免阻塞其他任务执行
- ✅ **增强WiFi AP模式启动**
  - 添加详细的AP启动调试信息
  - 增加AP启动失败时的自动重试机制
  - 优化AP配置参数设置

### v2.0.0 (WiFi配置管理器) - 重大功能更新
- ✅ **新增WiFi自动管理功能**
  - 智能WiFi连接和断线重连机制
  - AP配置模式自动切换
  - WiFi连接状态实时监控
- ✅ **新增现代化Web配置界面**
  - 响应式设计，支持移动端访问
  - 现代化UI/UX设计，渐变背景和卡片布局
  - WiFi网络扫描和信号强度显示
  - 实时状态指示器和动画效果
- ✅ **新增NVS配置存储功能**
  - WiFi配置信息持久化存储
  - 系统配置参数管理
  - 配置数据的读取、写入、清除操作
- ✅ **新增Web服务器管理器**
  - HTTP服务器和RESTful API
  - JSON数据交换格式
  - 多路由处理和错误页面
- ✅ **完整的模块化架构重构**
  - ConfigStorage类：NVS存储管理
  - WiFiManager类：WiFi连接管理
  - WebServerManager类：Web服务器管理
  - 面向对象的C++设计模式
- ✅ **FreeRTOS多任务优化**
  - WiFi管理任务（优先级3）
  - Web服务器任务（优先级2）
  - 任务优先级合理分配
- ✅ **系统信息监控**
  - 芯片型号和版本信息
  - 内存使用监控
  - 运行时间统计
  - WiFi信号强度监控

### v1.0.4 (Hello World持续输出)
- ✅ 修改Hello World任务为持续输出模式
- ✅ 每秒输出一次"hello world"
- ✅ 使用vTaskDelay实现1秒延时
- ✅ 添加循环机制，支持任务持续运行直至手动停止

### v1.0.3 (Hello World单次输出)
- ✅ 修改Hello World任务为单次输出模式
- ✅ 输出一次"hello world"后任务自动结束
- ✅ 移除无限循环和延时机制
- ✅ 优化任务生命周期管理

### v1.0.2 (修复分区表重叠问题)
- 🐛 修复partitions.csv分区表重叠问题
- 🐛 修复app分区对齐问题，确保符合0x10000边界对齐要求
- ✅ 调整app0分区起始地址从0x10000到0x20000，满足64KB边界对齐
- ✅ 优化app0和app1分区大小为0x5F0000
- ✅ 调整spiffs分区偏移到0xC00000，大小为0x2F0000
- ✅ 调整coredump分区偏移到0xEF0000，确保分区边界正确对齐

### v1.0.1 (修复任务运行问题)
- 🐛 修复任务只执行一次的竞态条件问题
- ✅ 调整isRunning标志设置时机，在任务创建前设置
- ✅ 优化任务循环逻辑，避免任务意外退出
- ✅ 确保Hello World能够持续每秒输出

### v1.0.0 (初始版本)
- ✅ 创建基础项目结构
- ✅ 实现Monitor监控器类
- ✅ 实现Hello World输出任务
- ✅ 配置FreeRTOS任务调度
- ✅ 设置任务优先级为2
- ✅ 实现每秒输出功能
- ✅ 添加模块化C++设计
- ✅ 使用printf进行调试输出
- ✅ setup()仅做初始化，loop()不处理任务

## 开发规范

1. 程序采用模块化设计，优先使用C++
2. 使用FreeRTOS进行开发，通过任务实现功能
3. setup()只做初始化，loop()不做任何任务处理
4. 使用printf输出调试信息（无串口配置）
5. 合理调整各个任务的优先级
6. WiFi配置信息保存在NVS中持久化存储
7. Web界面采用现代化响应式设计

## 故障排除

### WiFi连接问题
- 检查WiFi名称和密码是否正确
- 确认WiFi网络的加密方式（支持WPA/WPA2）
- 检查WiFi信号强度是否足够
- 尝试重启设备重新配置

### Web界面访问问题
- 确认已连接到ESP32S3-Config热点
- 检查IP地址是否正确（AP模式：192.168.4.1）
- 尝试清除浏览器缓存
- 使用不同浏览器测试

### 设备重启问题
- 检查电源供应是否稳定
- 查看串口监视器的错误日志
- 确认固件版本兼容性

## 未来计划

- [ ] 添加MQTT客户端功能
- [ ] 实现OTA固件更新
- [ ] 添加传感器数据采集
- [ ] 实现数据可视化界面
- [ ] 添加定时任务功能
- [ ] 支持多种认证方式 