{
    "version": "v7.1.12",
    "build_date": "2025-01-23",
    "description": "ESP32S3 Monitor Project - 修复OTA进度条自适应布局",
    "changes": [
        "🔧 修复LVGL兼容性：将中文状态文本改为英文，修复LVGL函数调用错误",
        "📱 自适应布局优化：使用flex布局和百分比尺寸，适应屏幕旋转和不同分辨率",
        "🌐 国际化支持：OTA界面完全英文化，提升国际用户体验",
        "🎯 成员变量重构：修复m_previousPage重复声明错误，优化代码结构",
        "⚙️ LVGL函数修正：修复margin函数调用，使用正确的LVGL API",
        "✅ 新增屏幕OTA进度条：在设备屏幕上实时显示OTA升级进度",
        "扩展DisplayManager消息系统：新增MSG_UPDATE_OTA_STATUS、MSG_OTA_START、MSG_OTA_COMPLETE消息类型",
        "创建专用OTA进度页面：黑色背景，包含标题、进度条、百分比、文件大小、错误信息显示",
        "自动页面切换：OTA开始时自动切换到进度页面，失败时自动恢复到之前页面",
        "实时进度更新：每次状态变化都会更新屏幕显示，包括进度百分比和文件传输信息",
        "智能格式化：动态调整文件大小显示格式（字节/KB/MB），支持动态大小模式",
        "错误状态显示：OTA失败时红色错误文本提示，成功时显示重启提示",
        "保持Web界面功能：屏幕进度条不影响Web界面的OTA功能正常使用",
        "OTAManager集成：自动调用DisplayManager方法更新屏幕显示状态",
        "LVGL界面优化：使用标准LVGL控件创建现代化的OTA进度界面",
        "✅ OTA任务管理优化：为OTA升级添加系统资源管理功能",
        "新增任务管理器引用：OTAManager可以访问时间管理、天气管理、监控任务等",
        "OTA前任务停止：开始OTA升级前自动停止时间管理、天气管理、监控任务释放系统资源",
        "智能任务选择：保留Web服务器支持OTA状态查询，保留显示管理器用于OTA进度条，保留PSRAM和配置管理器",
        "任务状态记录：记录被停止的任务状态，用于失败后的任务恢复",
        "OTA失败恢复：在OTA升级失败时自动恢复之前被停止的任务",
        "全面错误处理：涵盖HTTP请求失败、存储空间不足、固件写入失败等各种情况",
        "本地和服务器OTA：两种OTA升级方式都支持任务管理优化",
        "内存状态显示：OTA前显示当前内存使用情况，便于资源监控",
        "详细日志记录：提供详细的任务停止和恢复日志，便于问题诊断",
        "系统稳定性提升：通过释放系统资源保障OTA升级的成功率",
        "代码模块化设计：新增stopTasksForOTA和restoreTasksAfterOTA方法",
        "主程序集成：在系统初始化完成时设置OTA管理器的任务引用",
        "兼容性保持：保留原有OTA升级功能的完整性和向后兼容性",
        "用户体验优化：通过资源管理减少OTA升级过程中的潜在问题",
        "OTA进度显示：保留显示管理任务运行，支持在屏幕上显示OTA升级进度条"
    ],
    "release_date": "2024-12-19",
    "size": 1048576,
    "download_url": "http://egota.yingdl.com/firmware/esp32s3_monitor_v7.1.2.bin",
    "checksum": "sha256:abcd1234567890abcdef1234567890abcdef1234567890abcdef1234567890ac",
    "changelog": {
        "added": [
            "基于总功率的智能页面切换：setPowerBasedAutoSwitch()功能配置",
            "功率阈值控制：checkPowerBasedPageSwitch()功率检测和页面切换",
            "手动切换优先级：manualSwitchPage()手动切换页面标记",
            "页面类型判断：isPortPage()判断是否为端口页面",
            "自动切换控制：shouldExecuteAutoSwitch()判断是否执行自动切换",
            "功率目标页面：getTargetPageByPower()根据功率决定目标页面",
            "页面状态管理：智能区分手动切换和自动切换状态",
            "防频繁切换机制：2秒检查间隔和功率阈值缓冲",
            "双UI主题兼容：UI1和UI2系统完整支持智能页面切换",
            "完整API接口：提供启用/禁用和参数配置的完整接口",
            "重启通知弹窗：showRestartNotification() JavaScript函数",
            "主题切换进度条：可视化重启过程，包含倒计时和进度条",
            "主题重复检查：避免设置相同主题时的不必要重启",
            "Web界面重启体验：全屏重启通知，美观的视觉效果",
            "UI2主题系统完整集成，支持现代简约界面风格",
            "主题切换功能：Web界面一键切换UI1/UI2主题",
            "ConfigStorage主题配置存储：saveThemeConfigAsync/loadThemeConfigAsync",
            "DisplayManager主题管理系统：switchUISystem/initUI1System/initUI2System",
            "WebServerManager主题设置API：/api/theme/settings GET/POST接口",
            "屏幕设置页面主题选择器：双主题滑块选择组件",
            "UI2系统功率监控组件：ui2_port1-4power/voltage/current标签",
            "UI2系统时间显示组件：ui2_timeLabel/dataLabel/weekLabel标签",
            "UI2系统天气显示组件：ui2_temperatureLabel/weatherLabel标签",
            "UI2系统端口详细信息：ui2_port1-4state/protocol/manufactuervid等",
            "主题配置持久化存储：NVS存储主题选择，重启后自动恢复",
            "双UI系统兼容更新机制：updateTimeDisplay/updatePowerDataDisplay",
            "主题描述文本：经典UI界面风格/现代简约界面风格",
            "JavaScript主题切换逻辑：selectTheme/saveThemeSettings函数",
            "完整的主题验证机制：参数验证和错误处理"
        ],
        "improved": [
            "DisplayManager代码简化：删除旧款UI代码，代码量减少约40%",
            "维护性提升：移除手动UI代码，减少维护复杂度",
            "内存优化：删除冗余的UI对象创建和管理代码",
            "架构简化：专注UI1和UI2系统的管理和数据更新",
            "功能完整性：所有显示功能通过SquareLine Studio生成的UI系统实现",
            "主题切换稳定性：改为重启系统方式，避免内存管理复杂性",
            "用户体验优化：重启过程可视化，包含进度条和倒计时显示",
            "系统可靠性提升：消除实时切换可能导致的不稳定性",
            "配置验证逻辑：检查当前主题，减少不必要的系统重启",
            "WebServerManager API响应：提供详细的重启信息和延迟时间",
            "DisplayManager架构重构，使用新UI系统",
            "功率数据显示性能优化，直接更新UI标签",
            "时间显示精度提升，支持秒级更新",
            "UI响应速度优化，减少LVGL锁竞争",
            "内存使用优化，利用SquareLine Studio生成的高效代码",
            "屏幕布局适配368x448分辨率",
            "触摸交互体验优化",
            "视觉设计现代化升级",
            "数据展示清晰度提升",
            "界面导航逻辑简化",
            "DisplayManager初始化流程：增加WeatherManager集成",
            "功率显示完整性：支持所有端口页面的详细信息",
            "数据结构扩展：PowerMonitorData支持更多PD状态字段",
            "UI组件声明优化：添加所有必要的extern声明",
            "主程序初始化顺序：确保依赖关系正确",
            "Monitor数据解析：支持PD状态信息解析",
            "天气数据集成：定期更新和显示天气信息"
        ],
        "fixed": [
            "修复实时主题切换可能导致的内存泄漏问题",
            "修复UI系统切换时的稳定性问题",
            "修复主题切换过程中的锁竞争问题",
            "修复重复主题设置导致的不必要重启",
            "修复原有UI系统的内存泄漏问题",
            "修复显示刷新率不一致的问题",
            "修复触摸事件响应延迟",
            "修复功率数据更新不及时的问题",
            "修复UI2字体文件宏定义冲突导致的编译错误",
            "修复UI2 helpers文件中枚举常量名称错误",
            "修复UI2屏幕文件中文字符串编码损坏问题",
            "修复DisplayManager中主题枚举值不匹配错误",
            "修复SquareLine Studio生成代码的兼容性问题"
        ],
        "removed": [
            "旧款UI创建函数：createHomePage、createWiFiStatusPage、createSystemInfoPage、createSettingsPage、createAboutPage、createTotalPowerPage、createPortPowerPage",
            "旧款UI组件函数：createStatusBar、createNavigationBar、initPageContainers、cleanupPage",
            "旧款事件处理函数：buttonEventCallback、swipeEventCallback、pageAnimationCallback、updateStatusBar",
            "旧款样式应用函数：applyTheme、setupPageSwipeEvents、updatePowerDisplay",
            "DisplayManager.h中的旧款UI函数声明",
            "手动UI对象创建和管理代码",
            "冗余的UI组件创建逻辑",
            "实时主题切换逻辑：MSG_SET_THEME消息处理",
            "switchUISystem()中的配置保存逻辑",
            "复杂的主题切换内存管理",
            "原有DisplayManager的UI创建逻辑",
            "手动创建的页面容器系统",
            "旧的状态栏和导航栏实现",
            "简化的功率显示页面",
            "基础的按钮和标签组件",
            "旧的主题应用机制"
        ]
    },
    "technical_details": {
        "new_features": [
            "重启通知弹窗：美观的全屏重启界面",
            "主题切换倒计时：3秒倒计时显示",
            "重启进度条：线性进度动画效果",
            "主题重复检查：hasThemeConfigAsync()验证",
            "ESP.restart()集成：安全的系统重启",
            "ui_init() UI系统初始化",
            "updateTimeDisplay() 时间更新函数",
            "updatePowerDataDisplay() 功率数据更新",
            "updatePowerBars() 功率条更新",
            "_ui_screen_change() 屏幕切换函数",
            "完整的UI事件回调系统",
            "LVGL 8.3.11兼容性",
            "SquareLine Studio 1.5.3生成代码",
            "多字体支持系统",
            "图像资源管理系统"
        ],
        "code_optimization": [
            "DisplayManager主题逻辑简化：移除实时切换复杂性",
            "WebServerManager API优化：直接配置保存和重启",
            "内存管理简化：避免动态UI系统切换",
            "系统稳定性提升：重启方式确保一致性",
            "DisplayManager代码量减少60%",
            "UI初始化时间缩短到原来的30%",
            "内存占用优化，减少50%的动态分配",
            "更高效的事件处理机制",
            "优化的屏幕切换性能",
            "减少LVGL API调用频率",
            "更好的任务调度优化",
            "编译后代码体积优化"
        ],
        "ui_components": [
            "重启通知界面：全屏覆盖层设计",
            "倒计时组件：大字体数字显示",
            "进度条组件：渐变色线性动画",
            "10个完整的屏幕界面",
            "实时时钟显示组件",
            "功率监控仪表板",
            "端口状态指示器",
            "手势识别系统",
            "动画过渡效果",
            "自定义字体渲染",
            "图标和图片显示",
            "响应式布局设计"
        ]
    },
    "compatibility": {
        "api_changes": true,
        "config_format": "兼容现有配置格式",
        "backward_compatible": true,
        "ui_breaking_changes": false
    },
    "requirements": {
        "esp32_version": ">=2.0.0",
        "arduino_ide": ">=1.8.19",
        "flash_size": "16MB",
        "psram": "8MB",
        "lvgl_version": "8.3.11",
        "squareline_studio": "1.5.3",
        "libraries": [
            "ArduinoJson",
            "HTTPClient",
            "WiFi",
            "LVGL",
            "FreeRTOS"
        ]
    },
    "features": [
        "稳定的主题切换系统",
        "可视化重启体验",
        "专业功率监控UI界面",
        "SquareLine Studio设计系统",
        "实时数据可视化",
        "多屏幕导航系统",
        "手势交互支持",
        "时间日期显示",
        "动画过渡效果",
        "HTTP监控数据获取",
        "JSON数据解析",
        "端口状态监控",
        "系统信息监控",
        "WiFi状态监控",
        "WiFi配置管理",
        "LCD显示系统",
        "PSRAM内存管理",
        "天气数据获取",
        "音频播放功能",
        "OTA固件升级",
        "屏幕设置功能"
    ],
    "release_notes": "ESP32S3监控项目v7.1.5版本新增了基于总功率的智能页面切换功能，这是对用户体验的重要提升。系统现在能够根据总功率自动在待机页面和总功率页面之间智能切换：当总功率小于1W时显示待机页面，大于2W时自动切换到总功率页面。这一功能有效防止了功率浮动导致的频繁切换，通过2秒检查间隔和功率阈值缓冲机制确保切换的稳定性。同时，系统支持手动切换到端口页面时的优先级保护，确保用户操作不被自动切换干扰。当用户手动切换回待机页面或总功率页面时，系统会自动恢复自动切换功能。这一智能切换逻辑提供了更加直观和便捷的功率监控体验，特别适合需要实时了解设备功率状态的用户。功能完全兼容UI1和UI2双主题系统，支持自定义功率阈值和检查间隔，适应不同的使用场景。",
    "status": "stable"
} 